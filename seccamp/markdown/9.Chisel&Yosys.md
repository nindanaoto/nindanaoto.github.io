---
marp: true
---
<!-- 
theme: default
size: 16:9
paginate: true
footer : ![](../image/ccbysa.png) [licence](https://creativecommons.org/licenses/by-sa/4.0/)
style: |
  h1, h2, h3, h4, h5, header, footer {
        color: white;
    }
  section {
    background-color: #505050;
    color:white
  }
  table{
      color:black
  }
  code{
    color:black
  }
  a {
    font-weight:bold;
    color:#F00;
  } 
-->

<!-- page_number: true -->

# TFHE実装入門

## 9.Chisel&Yosys

松岡　航太郎

---

## このスライドで話すこと

- TFHEは論理ゲートの処理をサポートする
- ∴処理したい関数を論理回路で表現する必要がある
- 実際のハードウェアで使用する方法を流用する
- ネットリストを生成してその形式の説明まで

---

## Chiselとは

- Hardware Description Language(HDL)の一つ
- メジャーなHDLであるVerilogにトランスパイルされる
- RISC Vのコアを記述するために作られた
- モダンで比較的書きやすい
- Scala上のDSLとして実装されている
- Scalaでシミュレーションができる
- この段階では論理ゲートはでてこない
- 回路が満たすべき仕様を記述する

---

## Chiselの例(Counter)
- ソースコードは../src/main/scalaの下に置く

```
import chisel3._
class Counter extends Module {//本体
  val io = IO(new Bundle {//IOの定義
    val amt = Input(UInt(4.W))
    val tot = Output(UInt(8.W))
  })

  val cnt = RegInit(0.U(8.W))//8bitのレジスタをカウンタとして持つ
  cnt := cnt + io.amt//1クロックごとにamtだけインクリメント

  io.tot := cnt //レジスタをそのまま出力として吐く
}

object Elaborate extends App {
  chisel3.Driver.execute(args, () => new Counter()) //Counterをverilogに吐く対象として設定
}
```

---

## Yosys

- オープンソースの論理合成ソフト
- Verilog以外も入力に取れる
- HDLから論理ゲートのネットリストを生成する
- オプションはいろいろあるが既存品の流用が賢明か
- TFHEではに入力の論理ゲートとMUXしかないのでそのことを伝えるのが大事
- abc -g gates,MUX
- abcはバークレーの論理合成ソフトでYosysは実質フロントエンド

---

## ネットリスト

- ネットリストとは端子間の接続を記述したデータのこと
- ここでは論理回路の表現
- Yosysは複数の形式でネットリストを吐くことができる
- ここでは講師が利用しているJSONネットリストの形式を扱う
- ネットリストをパースしそれに基づいてTFHEのゲートを実行すればいい

---

## JSONネットリスト形式(全体像)
- [公式](http://www.clifford.at/yosys/cmd_write_json.html)からとってきたがもうちょい管理用の情報みたいなのも出てくる

```
 {
      "modules": {
        <module_name>: {
          "ports": {
            <port_name>: <port_details>,
            ...
          },
          "cells": {
            <cell_name>: <cell_details>,
            ...
          },
          "netnames": {
            <net_name>: <net_details>,
            ...
          }
        }
      },
      "models": {
        ...
      },
  }
```

---

---

## タスク発行のイメージ

- 講師とチュータの未踏の成果報告書の図

![](../image/dependency_solver.png)

---

## Iyokan

- 

---

## 参考文献